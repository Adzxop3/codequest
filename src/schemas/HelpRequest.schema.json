{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://codequest.dev/schemas/HelpRequest.schema.json",
  "title": "Help Request",
  "description": "Schema for help requests generated by students",
  "type": "object",
  "required": ["timestamp", "sceneId", "environment"],
  "properties": {
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when help was requested"
    },
    "sceneId": {
      "type": "string",
      "pattern": "^[A-Z][0-9]{2}-[a-z0-9-]+$",
      "description": "Scene identifier where help is needed"
    },
    "environment": {
      "type": "object",
      "required": ["node", "platform", "cwd"],
      "properties": {
        "node": {
          "type": "string",
          "description": "Node.js version (e.g., 'v16.14.0')"
        },
        "platform": {
          "type": "string",
          "enum": ["darwin", "linux", "win32"],
          "description": "Operating system platform"
        },
        "cwd": {
          "type": "string",
          "description": "Current working directory"
        },
        "shell": {
          "type": "string",
          "description": "Shell being used (optional)"
        },
        "terminal": {
          "type": "string",
          "description": "Terminal application (optional)"
        }
      }
    },
    "gitStatus": {
      "type": "string",
      "description": "Output of 'git status --porcelain' command"
    },
    "lastError": {
      "type": "object",
      "properties": {
        "command": {
          "type": "string",
          "description": "Command that produced the error"
        },
        "output": {
          "type": "string",
          "description": "Error output or message"
        },
        "exitCode": {
          "type": "number",
          "description": "Exit code of the failed command"
        }
      },
      "description": "Information about the last error encountered"
    },
    "attempts": {
      "type": "number",
      "minimum": 1,
      "description": "Number of attempts made on this scene"
    },
    "studentMessage": {
      "type": "string",
      "maxLength": 1000,
      "description": "Optional message from the student describing the issue"
    },
    "contextFiles": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["path", "content"],
        "properties": {
          "path": {
            "type": "string",
            "description": "Relative path to the file"
          },
          "content": {
            "type": "string",
            "description": "File content (truncated if too long)"
          },
          "truncated": {
            "type": "boolean",
            "default": false,
            "description": "Whether content was truncated"
          }
        }
      },
      "description": "Relevant files to provide context for the help request"
    },
    "priority": {
      "type": "string",
      "enum": ["low", "medium", "high", "urgent"],
      "default": "medium",
      "description": "Priority level of the help request"
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^[a-z0-9-]+$"
      },
      "description": "Tags to categorize the help request"
    },
    "resolved": {
      "type": "boolean",
      "default": false,
      "description": "Whether this help request has been resolved"
    },
    "resolution": {
      "type": "object",
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When the issue was resolved"
        },
        "method": {
          "type": "string",
          "enum": ["self-resolved", "instructor-help", "peer-help", "documentation"],
          "description": "How the issue was resolved"
        },
        "notes": {
          "type": "string",
          "maxLength": 500,
          "description": "Notes about the resolution"
        }
      },
      "description": "Resolution information (if resolved)"
    }
  }
}